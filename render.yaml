version: "1"
projects:
- name: Dating App
  environments:
  - name: Production
    services:
    - type: web
      name: dating-app
      runtime: static
      repo: https://github.com/rkeshwani/dating-app
      buildCommand: npm run build
      staticPublishPath: dist
      autoDeployTrigger: commit
      rootDir: ./client
      envVars:
      - key: VITE_API_BASE_URL
        fromService:
          type: web
          name: dating-app-backend
          property: url
      previews:
        generation: automatic
    - type: web
      name: dating-app-backend
      runtime: node
      repo: https://github.com/rkeshwani/dating-app
      plan: free
      region: oregon
      # Magic build command: Switch SQLite -> Postgres, Install, Generate, Build, DB Push (skip migrations)
      buildCommand: "sed -i 's/provider = \"sqlite\"/provider = \"postgresql\"/g' prisma/schema.prisma && npm install && npx prisma generate && npm run build && npx prisma db push"
      startCommand: npm start
      autoDeployTrigger: commit
      rootDir: server
      envVars:
      - key: CLIENT_URL
        fromService:
          type: web
          name: dating-app
          property: url
      - key: DATABASE_URL
        fromService:
          type: psql
          name: dating-app-db
          property: connectionString
      - key: SESSION_SECRET
        generateValue: true
      - key: GEMINI_API_KEY
        sync: false
      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: GOOGLE_CLIENT_SECRET
        sync: false
      - key: FACEBOOK_APP_ID
        sync: false
      - key: FACEBOOK_APP_SECRET
        sync: false
      previews:
        generation: automatic
    - type: psql
      name: dating-app-db
      plan: free
      region: oregon
      databaseName: dating_app_db
      user: dating_app_user
